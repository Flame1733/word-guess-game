workflows:
  react_build_and_deploy:
    name: "React Build and Beta Test Deploy"
    environment:
      node: "20"
      # groups:
      #   -"beta-testers"

    scripts:
      - name: "Install Dependencies"
        script: "npm ci"
      - name: "Build Project"
        script: "npm run build"
      - name: "Build Android APK"
        script: |
          cd android
          ./gradlew assembleRelease
          cd ..

    artifacts:
      - android/app/build/outputs/apk/release/app-release.apk  

    publishing:
      scripts:
        - name: "Deploy to Firebase App Distribution"
          script: |
            echo "Writing Firebase credentials to /tmp/firebase-key.json..."
            echo "$GOOGLE_APPLICATION_CREDENTIALS" > /tmp/firebase-key.json
            export GOOGLE_APPLICATION_CREDENTIALS=/tmp/firebase-key.json

            if [ -f "android/app/build/outputs/apk/release/app-release.apk" ]; then
              echo "APK found! Deploying to Firebase..."
              firebase appdistribution:distribute android/app/build/outputs/apk/release/app-release.apk \
                --app 1:559732628127:web:845bbd360592c79895e0aa
            else
              echo "Error: APK file not found! Build might have failed."
              exit 1
            fi

      email:
        recipients:
          - al-hattami@outlook.com
